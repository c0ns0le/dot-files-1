#!/bin/bash

pomodoro () {
  for a in $(seq ${1:-25} 1)
  do
    [[ $(( $a % 5 )) -eq 0 ]] && say "$a minutes left"
    [[ $a -lt 4 ]] && say "$a minutes left"

    [[ -z $2 ]] && echo "echo echo '$a minutes left' >~/.pomos/pomo_runner" >~/.pomos/pomo_commands

    echo -n "$(printf "%02d" $a) => "

    for b in $(seq 1 20)
    do
      sleep 3
      echo -n '.'
    done

    echo
  done

  [[ -z $2 ]] && say "break is over"
  [[ -z $2 ]] && echo 'echo tmux a >~/.pomos/pomo_runner' >~/.pomos/pomo_commands
  [[ -z $2 ]] || echo "tmux ${2}" >~/.pomos/pomo_commands
}

case $1 in
  ('')
    pomodoro 25 detach-client
  ;;

  (run)
    while true
    do
      for a in $(seq 1 4)
      do
        pomodoro 25 detach
        [[ $a -lt 4 ]] && pomo sb || pomo lb
      done
    done
  ;;


  (sb|short-break|short|break)
    pomodoro 5
  ;;

  (lb|long-break|long)
    pomodoro 15
  ;;

  ([0-9]*)
    pomodoro $1 detach-client
  ;;

  (*)
    cat <<OPTIONS
  USAGE:

    pomo                # => 25m timer

    pomo [0-9]+         # => timer for specified minutes

    pomo sb             # => 5m timer
    pomo short          # => 5m timer
    pomo short-break    # => 5m timer
    pomo break          # => 5m timer

    pomo lb             # => 15m timer
    pomo long           # => 15m timer
    pomo long-break     # => 15m timer

    pomo help           # => This help message

OPTIONS
  ;;

esac
