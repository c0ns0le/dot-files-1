#!/bin/bash

config="${HOME}/.notes.conf"
source "$config"

. $HOME/bin/bash.library
. $HOME/bin/list.library

cd "${lists_dir}"
case $1 in

  ('')
    echo
    echo "Next time add the name of the note you want want edit..."
    echo ;;

  (-e)
    remove_switch $@

    ## if no file was specified, use readline for tab completion
    if [ -z $2 ]; then
      echo "Enter note to edit: "
      read -e input
    elif [ -d "$2" ]; then
      if [ -f "${2}/index" ]; then
        vim -O "${2}/index"
        exit
      elif [ -f "${2}/list" ]; then
        vim -O "${2}/list"
        exit
      else
        ls "${2}/"
        echo
        echo -n "Open ${2}/: "
        read -e dirfile
        if [ -f "${2}/${dirfile}" ]; then
          vim -O "${2}/${dirfile}"
        fi
      fi
    else
      case $2 in
        ('sch')
          list -e calendar/list
          echo
          exit ;;

        ('sched')
          list -e calendar/list
          echo
          exit ;;

        ('schedule')
          list -e calendar/list
          echo
          exit ;;
      esac
    fi

    ensure_paths "$input"
    vim -O $input ;;

  #(-new | --new)
  ( -new | --new)
    newfilename="new/$(date +'%Y%m%d.%s')"
    vim "$newfilename" ;;

  (-g)
    garg="${@/-g/}"
    garg=${garg# }
    good_dirs="$(find . -type d -depth 1 | egrep -v 'nogrep|\.git|home|erlang')"
    egrep -RiI "$garg" $good_dirs | egrep -E '^.{1,200}$' ;;

  (-gl | --gl)
    garg="${@/-gl/}"
    garg=${garg# }
    good_dirs="$(find . -type d -depth 1 | egrep -v 'nogrep|\.git|home|erlang')"
    grep -RiIl "$garg" $good_dirs ;;

  (-dir | --dir)
    echo "${lists_dir}"
    exit ;;

  (-find | -f | --find)
    not='(erlang.api|home|.git|android-sdk-mac|DS_Store|nogrep)'
    ls -1 "${lists_dir}" | grep -vE "$not" | while read line
    do
      find -L "${lists_dir}/${line}" -type f | grep -vE "$not" | grep "$2"
    done ;;

  (-ls | --ls)
    #clear
    if [ -z ${lists_dir}/$2 ]
    then
      echo
      cd ${lists_dir}
      ls -GRp
    else
      echo
      ls -GRp ${lists_dir}/$2
      echo
    fi ;;

  (-cat | --cat)
    if [ -z $2 ]; then
      find . -type d -not -path '*.git*' -not -path 'home' -not -path '*nogrep*' -not -path '*erlang*api*' | column
      echo
    else
      shift
      ls -AFR $@   ### Used to be $2 then $* now $@
    fi ;;

  (-edit | --edit)
    vim $0 ;;

  (*)
    echo 'should probably cat each of the args passed in at this point...because you are not editing them' ;;

esac

#exit 0


#  Changelog
#
#  [ 2010-02-15 21:43:13 ]
#    Removed all of the clear commands, because those commands are
#    not very unix-like, and go against typical reusability conventions.
#

